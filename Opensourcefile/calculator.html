<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Calculator</title>
  <style>
    :root {
      --bg: #0f1724;
      --panel: #0b1220;
      --accent: #60a5fa;
      --soft: #94a3b8;
      --glass: rgba(255, 255, 255, 0.03);
      --radius: 14px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    * {
      box-sizing: border-box
    }

    body {
      background: linear-gradient(180deg, #071427 0%, #081428 100%);
      min-height: 100vh;
      color: #e6eef8;
      margin: 0;
      padding: 24px
    }

    .app-container {
      display: grid;
      grid-template-columns: 360px auto auto;
      grid-template-rows: auto auto;
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
      min-height: calc(100vh - 48px)
    }
    
    .calculator-section {
      grid-column: 1;
      grid-row: 1;
    }
    
    .memory-section {
      grid-column: 2;
      grid-row: 1;
    }
    
    .history-section {
      grid-column: 3;
      grid-row: 1;
    }
    
    .reference-section {
      grid-column: span 3;
      grid-row: 2;
    }

    .section {
      background: linear-gradient(180deg, var(--panel), rgba(255, 255, 255, 0.02));
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 8px 30px rgba(2, 6, 23, 0.7);
      position: relative;
    }
    
    .section-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .section-icon {
      font-size: 20px;
    }
    
    .section-title {
      font-size: 16px;
      font-weight: 600;
      color: #e6eef8;
      margin: 0;
    }
    
    .calculator-section {
      width: 100%;
      max-width: 400px;
    }

    .memory-section,
    .history-section {
      width: 100%;
    }

    .memory-display {
      background: var(--glass);
      padding: 12px;
      border-radius: 12px;
      margin-bottom: 16px
    }

    .memory-display h4 {
      margin: 0 0 10px 0;
      font-size: 14px;
      color: var(--soft);
      text-align: center
    }

    .memory-value {
      font-size: 20px;
      font-weight: 600;
      text-align: center;
      color: #e6eef8;
      padding: 8px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 8px;
      min-height: 40px;
      display: flex;
      align-items: center;
      justify-content: center
    }

    .memory-actions {
      display: flex;
      flex-direction: column;
      gap: 8px
    }

    .memory-actions button {
      padding: 10px;
      font-size: 14px;
      text-align: left
    }

    .display {
      background: var(--glass);
      padding: 12px;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      gap: 6px
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center
    }

    .title {
      font-size: 14px;
      color: var(--soft)
    }

    .screen {
      min-height: 56px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-end;
      font-size: 28px;
      padding: 6px 8px;
      color: #e6eef8
    }

    .screen small {
      color: var(--soft);
      font-size: 12px
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 14px
    }

    .memory-buttons {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      margin-bottom: 10px
    }

    button {
      border: 0;
      padding: 16px;
      border-radius: 12px;
      font-size: 18px;
      cursor: pointer;
      outline: none;
      background: transparent;
      color: var(--soft);
      backdrop-filter: blur(6px);
    }

    button.operator {
      background: linear-gradient(180deg, rgba(96, 165, 250, 0.12), rgba(96, 165, 250, 0.06));
      color: var(--accent);
      font-weight: 600
    }

    button.danger {
      background: linear-gradient(180deg, rgba(240, 82, 82, 0.10), rgba(240, 82, 82, 0.04));
      color: #ffb4b4
    }

    button.equal {
      grid-column: span 2;
      background: linear-gradient(90deg, var(--accent), #3b82f6);
      color: white;
      font-weight: 700
    }

    button.wide {
      grid-column: span 2
    }

    .history-content {
      background: var(--glass);
      padding: 12px;
      border-radius: 12px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .history-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px
    }

    .history h4 {
      margin: 0;
      font-size: 13px;
      color: var(--soft)
    }

    .clear-history-btn {
      padding: 4px 8px;
      font-size: 11px;
      border-radius: 6px;
      background: linear-gradient(180deg, rgba(240, 82, 82, 0.15), rgba(240, 82, 82, 0.08));
      color: #ff9999;
      border: 1px solid rgba(240, 82, 82, 0.2);
      transition: all 0.2s ease
    }

    .clear-history-btn:hover {
      background: linear-gradient(180deg, rgba(240, 82, 82, 0.25), rgba(240, 82, 82, 0.15));
      color: #ffb4b4
    }

    .history-item {
      font-size: 13px;
      color: var(--soft);
      padding: 6px 8px;
      border-radius: 8px;
      margin-bottom: 6px;
      background: rgba(255, 255, 255, 0.015);
      display: flex;
      justify-content: space-between;
      align-items: center
    }

    .history-item small {
      color: #cbd5e1
    }

    .footer {
      margin-top: 16px;
      padding: 20px;
      background: linear-gradient(135deg, var(--glass), rgba(255, 255, 255, 0.08));
      border-radius: 16px;
      border: 1px solid rgba(96, 165, 250, 0.15);
      backdrop-filter: blur(15px);
      position: relative;
      overflow: hidden
    }

    .footer::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
      opacity: 0.6
    }

    .footer-content {
      display: flex;
      flex-direction: column;
      gap: 16px;
      position: relative
    }

    .footer-header {
      text-align: center;
      margin-bottom: 4px
    }

    .footer-title {
      font-size: 14px;
      font-weight: 700;
      color: #e6eef8;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px
    }

    .footer-title::before,
    .footer-title::after {
      content: '';
      width: 30px;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent));
      opacity: 0.5
    }

    .tips-container {
      display: flex;
      flex-direction: column;
      gap: 12px
    }

    .tip-card {
      padding: 12px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      position: relative;
      transition: all 0.3s ease
    }

    .tip-card:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(96, 165, 250, 0.2);
      transform: translateY(-1px)
    }

    .tip-icon {
      font-size: 16px;
      margin-bottom: 6px;
      display: block
    }

    .tip-title {
      margin: 0 0 6px 0;
      font-size: 12px;
      color: var(--accent);
      font-weight: 600;
      letter-spacing: 0.3px
    }

    .tip-description {
      margin: 0;
      font-size: 11px;
      color: var(--soft);
      line-height: 1.5;
      opacity: 0.9
    }

    .footer-divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      margin: 8px 0
    }

    .footer-brand {
      text-align: center;
      font-size: 11px;
      color: rgba(148, 163, 184, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px
    }

    .brand-icon {
      font-size: 14px;
      animation: sparkle 2s ease-in-out infinite alternate
    }

    @keyframes sparkle {
      0% {
        opacity: 0.7;
        transform: scale(1)
      }

      100% {
        opacity: 1;
        transform: scale(1.1)
      }
    }

    @media (max-width:768px) {
      .app-container {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto auto;
        gap: 16px;
      }
      .calculator-section{grid-column:1;grid-row:1}
      .memory-section{grid-column:1;grid-row:2}
      .history-section{grid-column:1;grid-row:3}
      .reference-section{grid-column:1;grid-row:4}
      .memory-actions{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    }

    @media (max-width:420px) {
      .section {
        padding: 14px;
      }

      .section-header {
        margin-bottom: 12px;
      }

      .section-title {
        font-size: 14px;
      }

      .section-icon {
        font-size: 18px;
      }

      .memory-buttons button,
      .buttons button {
        padding: 12px;
        font-size: 15px;
      }

      .screen {
        font-size: 22px;
      }

      .memory-actions {
        grid-template-columns: 1fr;
        gap: 6px
      }

      .memory-actions button {
        padding: 8px;
        font-size: 13px
      }

      .tip-card {
        padding: 10px
      }

      .tip-title {
        font-size: 11px
      }

      .tip-description {
        font-size: 10px
      }

      .footer-brand {
        font-size: 10px
      }

      .history-content {
        max-height: 200px;
      }
    }
  </style>
</head>

<body>
  <div class="app-container">
    <!-- Calculator Section -->
    <main class="calculator-section section" role="application" aria-label="Simple calculator">
      <div class="section-header">
        <span class="section-icon">🧮</span>
        <h2 class="section-title">Calculator</h2>
      </div>
      
      <div class="display">
        <div class="top-row">
          <div class="title">Calculator</div>
          <div class="title">Press Esc to clear</div>
        </div>
        <div class="screen" id="screen">
          <small id="prev"></small>
          <div id="current">0</div>
        </div>
      </div>

      <div class="memory-buttons">
        <button data-action="mc" title="Memory Clear">MC</button>
        <button data-action="mr" title="Memory Recall">MR</button>
        <button data-action="mplus" title="Memory Add">M+</button>
        <button data-action="mminus" title="Memory Subtract">M-</button>
        <button data-action="ms" title="Memory Store">MS</button>
      </div>

      <div class="buttons" aria-hidden="false">
        <button class="danger" data-action="clear">C</button>
        <button data-action="back">⌫</button>
        <button data-action="percent">%</button>
        <button class="operator" data-value="/">÷</button>

        <button data-value="7">7</button>
        <button data-value="8">8</button>
        <button data-value="9">9</button>
        <button class="operator" data-value="*">×</button>

        <button data-value="4">4</button>
        <button data-value="5">5</button>
        <button data-value="6">6</button>
        <button class="operator" data-value="-">−</button>

        <button data-value="1">1</button>
        <button data-value="2">2</button>
        <button data-value="3">3</button>
        <button class="operator" data-value="+">+</button>

        <button data-value="0" class="wide">0</button>
        <button data-value=".">.</button>
        <button class="equal" data-action="equals">=</button>
      </div>
    </main>

    <!-- Reference Guide Section -->
    <aside class="reference-section section">
      <div class="section-header">
        <span class="section-icon">📖</span>
        <h2 class="section-title">Reference Guide</h2>
      </div>
      
      <div class="tips-container">
        <div class="tip-card">
          <span class="tip-icon">⌨️</span>
          <h5 class="tip-title">Keyboard Navigation</h5>
          <p class="tip-description">Use your keyboard for faster input: numbers (0-9), operators (+, -, *, /),
            Enter for equals, Escape to clear all</p>
        </div>

        <div class="tip-card">
          <span class="tip-icon">🎯</span>
          <h5 class="tip-title">Memory Shortcuts</h5>
          <p class="tip-description">Ctrl+M to store current value, Ctrl+R to recall, Ctrl+C to clear memory, Ctrl++ to add, Ctrl+- to subtract</p>
        </div>

        <div class="tip-card">
          <span class="tip-icon">📊</span>
          <h5 class="tip-title">History Features</h5>
          <p class="tip-description">Click any history item to use its result. All calculations are automatically saved and can be cleared using the Clear button</p>
        </div>

        <div class="tip-card">
          <span class="tip-icon">🔧</span>
          <h5 class="tip-title">Advanced Functions</h5>
          <p class="tip-description">Use % for percentage calculations, backspace to delete last digit, C to clear current input</p>
        </div>
      </div>
      
      <div class="footer-divider"></div>
      
      <div class="footer-brand">
        <span class="brand-icon">✨</span>
        <span>Advanced Calculator with Memory & History</span>
        <span class="brand-icon">✨</span>
      </div>
    </aside>

    <!-- Memory Section -->
    <aside class="memory-section section" role="complementary" aria-label="Memory display and actions">
      <div class="section-header">
        <span class="section-icon">💾</span>
        <h2 class="section-title">Memory</h2>
      </div>
      
      <div class="memory-display">
        <h4>Current Value</h4>
        <div class="memory-value" id="memory-display">0</div>
      </div>
      
      <div class="memory-actions">
        <button data-action="mc" title="Memory Clear">
          <span>MC</span> - Clear Memory
        </button>
        <button data-action="mr" title="Memory Recall">
          <span>MR</span> - Recall Memory
        </button>
        <button data-action="mplus" title="Memory Add">
          <span>M+</span> - Add to Memory
        </button>
        <button data-action="mminus" title="Memory Subtract">
          <span>M-</span> - Subtract from Memory
        </button>
        <button data-action="ms" title="Memory Store">
          <span>MS</span> - Store in Memory
        </button>
      </div>
    </aside>

    <!-- History Section -->
    <aside class="history-section section">
      <div class="section-header">
        <span class="section-icon">📝</span>
        <h2 class="section-title">History</h2>
      </div>
      
      <div class="history-content">
        <div class="history-actions">
          <span style="font-size: 12px; color: var(--soft);">Recent Calculations</span>
          <button class="clear-history-btn" data-action="clear-history" title="Clear History">Clear All</button>
        </div>
        <div id="history-list"></div>
      </div>
    </aside>
  </div>

  <script>
    const prevEl = document.getElementById('prev');
    const currEl = document.getElementById('current');
    const historyList = document.getElementById('history-list');
    const memoryDisplayEl = document.getElementById('memory-display');

    let current = '';
    let previous = '';
    let history = JSON.parse(localStorage.getItem('calc_history') || '[]');
    let memory = parseFloat(localStorage.getItem('calc_memory')) || 0;

    function render() {
      currEl.textContent = current || '0';
      prevEl.textContent = previous;
      renderHistory();
      updateMemoryDisplay();
    }

    function updateMemoryDisplay() {
      memoryDisplayEl.textContent = memory || '0';
    }

    function addToHistory(expr, result) {
      const item = { expr, result, ts: Date.now() };
      history.unshift(item);
      if (history.length > 12) history.pop();
      localStorage.setItem('calc_history', JSON.stringify(history));
      renderHistory();
    }

    function renderHistory() {
      historyList.innerHTML = '';
      history.forEach(h => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `<span>${h.expr}</span><small>${h.result}</small>`;
        div.addEventListener('click', () => {
          current = h.result.toString();
          render();
        });
        historyList.appendChild(div);
      });
    }

    function clearHistory() {
      history = [];
      localStorage.removeItem('calc_history');
      renderHistory();
    }

    function press(val) {
      if ('0123456789.'.includes(val)) {
        // prevent multiple dots
        if (val === '.' && current.includes('.')) return;
        current += val;
      } else if ('+-*/'.includes(val)) {
        if (!current && previous && /[+\-*/]$/.test(previous)) {
          // replace last operator
          previous = previous.slice(0, -1) + val;
        } else {
          if (!current && !previous) return;
          previous = (previous + current + val).trim();
          current = '';
        }
      }
      render();
    }

    function clearAll() { current = ''; previous = ''; render(); }
    function backspace() { current = current.slice(0, -1); render(); }

    function percent() {
      if (!current) return;
      try {
        current = (parseFloat(current) / 100).toString();
      } catch (e) { }
      render();
    }

    function compute() {
      let expr = (previous + current).replace(/×/g, '*').replace(/÷/g, '/');
      // sanitize: allow only digits, operators, parentheses and dot
      if (!/^[0-9+\-*/().\s%]+$/.test(expr)) {
        alert('Invalid expression');
        return;
      }
      try {
        // handle percent operator if present (convert % to /100)
        expr = expr.replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');
        const result = Function('return ' + expr)();
        addToHistory(previous + current, result);
        current = String(result);
        previous = '';
        render();
      } catch (e) {
        alert('Error in expression');
      }
    }

    // --- Memory Functions ---
    function memoryClear() {
      memory = 0;
      localStorage.setItem('calc_memory', '0');
      updateMemoryDisplay();
    }
    function memoryRecall() {
      current = memory.toString();
      render();
    }
    function memoryAdd() {
      let val = parseFloat(current || '0');
      if (!isNaN(val)) {
        memory += val;
        localStorage.setItem('calc_memory', memory.toString());
        updateMemoryDisplay();
      }
    }
    function memorySubtract() {
      let val = parseFloat(current || '0');
      if (!isNaN(val)) {
        memory -= val;
        localStorage.setItem('calc_memory', memory.toString());
        updateMemoryDisplay();
      }
    }
    function memoryStore() {
      let val = parseFloat(current || '0');
      if (!isNaN(val)) {
        memory = val;
        localStorage.setItem('calc_memory', memory.toString());
        updateMemoryDisplay();
      }
    }

    document.querySelectorAll('button').forEach(btn => {
      btn.addEventListener('click', () => {
        const v = btn.getAttribute('data-value');
        const action = btn.getAttribute('data-action');
        if (action === 'clear') clearAll();
        else if (action === 'back') backspace();
        else if (action === 'percent') percent();
        else if (action === 'equals') compute();
        else if (action === 'mc') memoryClear();
        else if (action === 'mr') memoryRecall();
        else if (action === 'mplus') memoryAdd();
        else if (action === 'mminus') memorySubtract();
        else if (action === 'ms') memoryStore();
        else if (action === 'clear-history') clearHistory();
        else if (v) press(v);
      });
    });

    // Keyboard support
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') clearAll();
      else if (e.key === 'Backspace') backspace();
      else if (e.key === 'Enter' || e.key === '=') compute();
      else if (e.key === '%') percent();
      else if (/^[0-9]$/.test(e.key) || e.key === '.') press(e.key);
      else if (['+', '-', '*', '/'].includes(e.key)) press(e.key);

      // Memory shortcuts: <kbd>Ctrl+M</kbd> (store), <kbd>Ctrl+R</kbd> (recall), <kbd>Ctrl+C</kbd> (clear), <kbd>Ctrl++</kbd> (add), <kbd>Ctrl+-</kbd> (subtract)
      if (e.ctrlKey) {
        if (e.key.toLowerCase() === 'm') { memoryStore(); e.preventDefault(); }
        else if (e.key.toLowerCase() === 'r') { memoryRecall(); e.preventDefault(); }
        else if (e.key.toLowerCase() === 'c') { memoryClear(); e.preventDefault(); }
        else if (e.key === '+') { memoryAdd(); e.preventDefault(); }
        else if (e.key === '-') { memorySubtract(); e.preventDefault(); }
      }
    });

    // initial render
    render();
  </script>
</body>

</html>